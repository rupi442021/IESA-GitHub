<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="utf-8" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../Scripts/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/GeneralFunctions.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>

    <!--//Email-->
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <!--//Email-->



    <title>&#x202E; איפוס סיסמה – ASEI</title>
    <link rel="icon" href="https://iesa.org.il/wp-content/uploads/2020/04/cropped-favic-32x32.png">


    <style type="text/css">

        /*Template Style*/

        body {
            background-color: #212529;
            color: white;
        }

        .container {
            background-color: #292e38;
            max-width: 1110px;
            padding-top: 30px;
            padding-bottom: 400px;
            position: relative;
        }

        .jumbotron {
            height: 70px;
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
        }

        /*Page title Open*/

        .titlelink {
            color: #FFFFFF;
            text-decoration: none;
            margin: 3px;
            font-weight: 600;
            font-size: 1.04rem;
            letter-spacing: .015em;
            line-height: 2;
        }

            .titlelink:hover {
                color: #04b8a5;
                transition: .15s color;
            }

        .headh2 {
            display: flex;
            align-items: center;
            /*margin-bottom: 55px;*/ /*#1*/
            font-weight: 600;
            letter-spacing: .015em;
            margin: 3px; /*#2*/
        }

            .headh2::after {
                content: '';
                flex: 1;
                margin-right: 10px;
                margin-top: 23px;
                opacity: 0.84;
                height: 2px;
                background-color: #fff;
            }

        .divdown {
            margin-bottom: 60px;
        }


        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            color: black;
            justify-content: normal;
        }

        /* Modal Content */
        .modal-content {
            position: relative;
            background-color: #fefefe;
        }

        .modal-footer {
            justify-content: normal;
        }

        #alertEmail, #alertEmailWrong {
            color: red;
        }

        /*Page title Close*/


        /*Template Style*/

    </style>

    <script>
        var email = "";
        $(document).ready(function () {

            $("#emailform").submit(function (e) {
                e.preventDefault();
                checkIfEmailExist();
            });
            
            $("#updatepass").submit(function (e) {
                e.preventDefault();
                updatePassword();
            });

            $("#emailInput").show();
            $("#otpInput").hide();
            $("#newPass").hide();

            
        });

        function checkIfEmailExist() {
            email = $("#emailTB").val();
            console.log(email);

            ajaxCall("GET", "../api/gamers/mark1?emailAdd=" + email, "", EmailSuccess, EmailError); //#method OG1 (Gamers Controllers)


        }


        function EmailSuccess(ans) {
            if (ans == 'exist' || ans == "exist") {

                var otp = Math.floor(100000 + Math.random() * 900000);
                localStorage.setItem("otp", otp);

                Email.send({
                    Host: "smtp.google.com",
                    Username: "reactapptest230@gmail.com",
                    Password: "FA1278973EE70094257D1CFD15BECDBA0BDC",

                    To: email,
                    From: "reactapptest230@gmail.com",
                    Subject: "עמותת הגיימינג - אימות אימייל",

                    Body: "שלום! להלן קוד האימות אותו תצטרכו להכניס במערכת: " + otp,

                }).then(
                    Swal.fire({
                        icon: 'success',
                        title: 'קוד אימות נשלח לכתובת האימייל שלך',
                        showConfirmButton: true,
                        timer: 2500
                    })
                );
                $("#emailInput").hide();
                $("#otpInput").show();
                $("#newPass").hide();

            }

            else
                $("#alerts").html("<p style='color: red;'>כתובת האימות לא נמצאה במערכת</p>")

        }

        function EmailError(err) {
            console.log(err)
        }

        function CheckOTP() {

            let otpfromlocalstorage = localStorage.getItem("otp");
            let otpfrominputuser = $("#otpTB").val();
            if (otpfrominputuser == otpfromlocalstorage) {
               console.log("Good!");
               $("#emailInput").hide();
               $("#otpInput").hide();
               $("#newPass").show();
            }

            else {
                console.log("Bad!");
                $("#alerts").html("<p style='color: red;'>קוד אימות שגוי, נסה שנית</p>")
            }


        }

        function updatePassword() {


        }

    </script>

</head>
<body>

    <section id="Nav-bar">
        <div class="jumbotron jumbotron-fluid" style="background-color:#04b8a5;">
        </div>
    </section>

    <section id="content">

        <div class="container">

            <section id="page_title">
                <a class="titlelink" href="TemplatePage.html">ראשי </a>
                <svg style="width: .5em; transform: rotate(180deg); vertical-align: -.17em;" svg-inline--fa fa-angle-right fa-w-8" aria-hidden="true" focusable="false" data-prefix="fa" data-icon="angle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><path fill="currentColor" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></svg>
                <a class="titlelink" href="TemplatePage.html">איפוס סיסמה </a>
                <svg style="width: .5em; transform: rotate(180deg); vertical-align: -.17em;" svg-inline--fa fa-angle-right fa-w-8" aria-hidden="true" focusable="false" data-prefix="fa" data-icon="angle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><path fill="currentColor" d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></svg>
                <h2 class="headh2">איפוס סיסמה</h2>
                <div class="divdown"></div>
            </section>

            <div id="emailInput">
                <form class="row g-3" id="emailform">
                    <div class="mt-3">
                        <label>כתובת דוא"ל:</label>
                        <input type="email" class="form-control" placeholder='הכנס כתובת דוא"ל לאיפוס כאן' id="emailTB" pattern="^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$" oninvalid="this.setCustomValidity('כתובת אימייל לא נכונה')" oninput="this.setCustomValidity('')" required>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" type="submit">אפס סיסמא</button>
                    </div>
                </form>
            </div>

            <div id="otpInput">
                <form class="row g-3">
                    <div class="mt-3">
                        <label>6 ספרות לאימות:</label>
                        <input type="text" class="form-control" placeholder='הכנס כאן את קוד האימות שקיבלת למייל' id="otpTB" pattern="^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$" oninvalid="this.setCustomValidity('כתובת אימייל לא נכונה')" oninput="this.setCustomValidity('')" required>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary" type="button" onclick="CheckOTP()">בדוק קוד אימות</button>
                    </div>
                </form>
            </div>

            <div id="newPass">

                <form id="updatepass" oninput='up2.setCustomValidity(up2.value != up.value ? "הסיסמאות לא זהות" : "")'>

                    <div class="form-group">
                        <label for="exampleInputEmail1">סיסמה חדשה</label>
                        <input type="password" class="form-control" id="exampleInputPassword1" placeholder="הכנס סיסמה חדשה" name=up required>
                        <small id="Help" class="form-text text-muted">מינימום 6 תווים, אותיות ומספרים.</small>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputPassword1">אימות סיסמה</label>
                        <input type="password" class="form-control" id="exampleInputPassword2" placeholder="הכנס אימות לסיסמה" name=up2>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">החלף סיסמה</button>
                </form>

            </div>
            <div id="alerts"></div>
        </div>


    </section>


    <section id="site_footer">
        <div class="jumbotron jumbotron-fluid" style="background-color:#1a1a1a;">
            <h2>IESA</h2>
        </div>
    </section>




</body>
</html>